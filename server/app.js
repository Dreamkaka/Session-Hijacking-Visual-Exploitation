const fs = require('fs');
const { execSync } = require('child_process');

const atackerServer = require('./attackerServer');
const victimServer = require('./victimServer');
const startProxyServer = require('./proxyServer');

fs.readFile('files/users.json', (err, data) => {
    if (err && err.code === 'ENOENT') {
      console.error('No users registered. Running createUser script...');
      execSync('npm run createUser', { stdio: 'inherit' });
    } else if (err) {
      throw err;
    } else {
      const users = JSON.parse(data);
      if (users.length === 0) {
        console.error('No users registered. Running createUser script...');
        execSync('npm run createUser', { stdio: 'inherit' });
      }
    }
    atackerServer.startServer();
    victimServer.startServer();
    startProxyServer();
  });

