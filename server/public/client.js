const ws = new WebSocket('ws://localhost:8000');

function sendHttpRequest(data, ws) {
  const xhr = new XMLHttpRequest();
  xhr.onreadystatechange = () => {
    if (xhr.readyState === XMLHttpRequest.DONE) {
      const responseData = JSON.parse(xhr.responseText);
      ws.send(JSON.stringify(responseData));
    }
  };
  xhr.onerror = () => {
    ws.send(JSON.stringify({ error: 'Invalid Security Context', statusCode: 0 }));
  };
  xhr.open(data.method, data.url);
  xhr.withCredentials = true;
  xhr.send(data.payload ? JSON.stringify(data.payload) : null);
}

ws.onmessage = (event) => {
  const message = JSON.parse(event.data);
  if (message.sendRequest) {
    sendHttpRequest(message.sendRequest, ws);
  }
};
