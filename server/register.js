const bcrypt = require('bcrypt');
const fs = require('fs');
const readline = require('readline');
const readlineSync = require('readline-sync');

const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

rl.question('Enter username: ', (username) => {
  const password = readlineSync.question('Enter password: ', {
    hideEchoBack: true // Esto oculta la contraseÃ±a
  });

  bcrypt.hash(password, 10, (err, hash) => {
    if (err) throw err;

    const newUser = {
      username,
      password: hash
    };

    fs.readFile('files/users.json', (err, data) => {
      if (err && err.code !== 'ENOENT') throw err;
      const users = err && err.code === 'ENOENT' ? [] : JSON.parse(data);
      users.push(newUser);

      fs.writeFile('files/users.json', JSON.stringify(users, null, 2), (err) => {
        if (err) throw err;
        console.log(`User ${username} registered successfully!`);
        rl.close();
      });
    });
  });
});
