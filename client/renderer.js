const { ipcRenderer } = require('electron');

const sessionsTable = document.getElementById('sessions-table');
const tbody = sessionsTable.getElementsByTagName('tbody')[0];

function openInteractiveWindow(sessionID) {
  ipcRenderer.send('open-interactive-window', sessionID);
}

function openVisualWindow(sessionID) {
  ipcRenderer.send('open-visual-window', sessionID);
}

function updateSessionsTable() {
  fetch('http://localhost:3000/sessions/list')
    .then((response) => response.json())
    .then((clients) => {
      tbody.innerHTML = '';

      if (clients) {
        clients.forEach((client) => {
          const newRow = tbody.insertRow();
          newRow.innerHTML = `
            <td>${client.id}</td>
            <td>${client.userAgent}</td>
            <td>${client.ip}</td>
            <td>
              <button onclick="openVisualWindow('${client.id}')">Visual mode</button>
              <button onclick="openInteractiveWindow('${client.id}')">Interactive mode</button>
            </td>
          `;
        });
      }
    })
    .catch((error) => console.error("Error fetching sessions data:", error));
}

document.getElementById('refresh-sessions').addEventListener('click', updateSessionsTable);
updateSessionsTable();